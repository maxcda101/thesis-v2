#{extends 'main.html' /}
#{set title:'Thống kê theo giờ' /}
<script src="@{'/public/javascripts/lib/Chart.bundle.min.js'}" type="text/javascript"
        charset="${_response_encoding}"></script>
<style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }


</style>

<script>

    var tempMedium=[];
    var tempMin=[];
    var tempMax=[];
    var airMedium=[]
    var airMin=[];
    var airMax=[];
    var humiMedium=[];
    var humiMin=[];
    var humiMax=[];

    #{list items:tempMedium, as:'item'}
        tempMedium.push(${item.value});
    #{/list}
    #{list items:tempMax, as:'item'}
        tempMax.push(${item.value});
    #{/list}
    #{list items:tempMin, as:'item'}
        tempMin.push(${item.value});
    #{/list}
    #{list items:airMedium, as:'item'}
        airMedium.push(${item.value});
    #{/list}
    #{list items:airMax, as:'item'}
        airMax.push(${item.value});
    #{/list}
    #{list items:airMin, as:'item'}
        airMin.push(${item.value});
    #{/list}
    #{list items:humiMedium, as:'item'}
        humiMedium.push(${item.value});
    #{/list}
    #{list items:humiMax, as:'item'}
        humiMax.push(${item.value});
    #{/list}
    #{list items:humiMin, as:'item'}
        humiMin.push(${item.value});
    #{/list}

    var MONTHS = ["00:00","1:00", "2:00", "3:00", "4:00", "5:00", "6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00"
    , "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00","23:00"];

    function myFunction(medium,max,min, a, b ,c) {
        var config = {
            type: 'line',
            data: {
                labels: MONTHS,
                datasets: [{
                    label: medium,
                    data: a,
                    borderColor: 'yellow',
                    pointBorderColor: 'yellow',
                    pointBackgroundColor: 'white',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                }, {
                    borderColor: 'red',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    pointBorderColor: 'red',
                    pointBackgroundColor: 'white',
                    label: max,
                    data: b,
                }, {
                    label: min,
                    borderColor: 'green',
                    pointBorderColor: 'green',
                    pointBackgroundColor: 'white',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    data: c,
                }]
            },
            options: {
                responsive: true,
    //            title:{
    //                display:true,
    //                text:'Chart.js Line Chart'
    //            },
                tooltips: {
                    mode: 'label',
                    callbacks: {

                    }
                },
                hover: {
                    mode: 'dataset'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            show: true,
                            labelString: 'Giờ'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            show: true,
                            labelString: 'Giá trị'
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 50,
                        }
                    }]
                }
            }
        };
        return config;
    }

    window.onload = function() {
        var ctxAir = document.getElementById("air").getContext("2d");
        var ctxTemp = document.getElementById("temp").getContext("2d");
        var ctxHumi = document.getElementById("humi").getContext("2d");

        var configTemp=myFunction("Nhiệt độ trung bình","Nhiệt độ cao nhất","Nhiệt độ thấp nhất",tempMedium,tempMax,tempMin );
        var configAir=myFunction("Không khi trung bình","Không khi cao nhất","Không khi thấp nhất",airMedium,airMax,airMin );
        var configHumi=myFunction("Độ ẩm trung bình","Độ ẩm cao nhất","Độ ẩm thấp nhất",humiMedium,humiMax,humiMin );

        window.myLine = new Chart(ctxAir, configAir);
        window.myLine = new Chart(ctxTemp, configTemp);
        window.myLine = new Chart(ctxHumi, configHumi);
    };
    $(document).ready(function () {
        $('#dp1, #dp2').datepicker({
            format: "dd-mm-yyyy",
            autoclose: true,
        }).on('change', function () {
            $('.datepicker').hide();
        });
    });

</script>
<h3 style="text-transform: uppercase" class="text-center">Thống kê theo từng giờ ${node.name}</h3>

#{form @Application.chart(), method:'GET'}
<div class="admin-form-group">
    <div class="wrapper-search">
        <div class="form-inline">
            <input type="hidden" name="commandCode" value="action"/>
            <label>Chọn ngày:</label>
            <input type="text" value="${date.format('dd-MM-yyyy')}" name="date"
                   class="form-control admin-input" id="dp1">

            <label>Chọn Node:</label>
            <select name="idNode" class="selectpicker show-tick" data-live-search="true" title="Chọn Node">
                #{list items:listNode, as:'node'}
                <option value="${node.id}">${node.name}</option>
                #{/list}
            </select>
        </div>

        <div class="form-inline">
        </div>
        <p class="alert-danger" style="margin-top: 10px">${notification}</p>
        <div class="form-inline action-button">
            <button type="submit" class="btn btn-info admin-btn" style="margin-right: 30px;">Tìm Kiếm</button>
        </div>
    </div>

</div>
#{/form}



<h3 style="text-transform: uppercase" class="text-center">Biểu đồ</h3>
<div style="width:100%;margin-top: 50px;">
    <canvas id="air"></canvas>
</div>
<h4 class="text-center">Biểu đồ chất lượng không khí</h4>

<div style="width:100%;margin-top: 50px;">
    <canvas id="temp"></canvas>
</div>
<h4 class="text-center">Biểu đồ nhiệt độ</h4>

<div style="width:100%; margin-top: 50px;">
    <canvas id="humi"></canvas>
</div>
<h4  class="text-center">Biểu đồ độ ẩm</h4>


