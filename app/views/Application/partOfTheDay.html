#{extends 'main.html' /}
#{set title:'Home' /}
<script src="@{'/public/javascripts/lib/Chart.bundle.min.js'}" type="text/javascript"
        charset="${_response_encoding}"></script>
<style>
    canvas{
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
     .bootstrap-select .btn{
        padding: 3px 4px; margin-top: 10px
    }
    .bootstrap-select .bs-searchbox input{
        padding: 3px 4px;
        height: 25px;
    }



</style>
<h3 style="text-transform: uppercase" class="text-center title">Thống kê theo buổi trong ngày</h3>

#{form @Application.partOfTheDay(), method:'GET'}

<div class="admin-form-group">
    <div class="wrapper-search">
        <div class="form-inline">
            <input type="hidden" name="commandCode" value="action"/>
            <label>Từ Ngày:</label>
            <input type="text" value="${startDate.format('dd-MM-yyyy')}" name="startDate"
                   class="form-control admin-input" id="dp1">
            <label style="margin-left: 20px;">Đến Ngày:</label>
            <input type="text" value="${endDate.format('dd-MM-yyyy')}" name="endDate" class="form-control admin-input"
                   id="dp2">
        </div>
        <div class="form-inline">

            <select name="idNode" class="selectpicker show-tick" data-live-search="true"
                    title="Chọn Node">
                #{list items:listNode, as:'node'}
                <option value="${node.id}">${node.name}</option>
                #{/list}
            </select>

            <select name="idSensor" class="selectpicker show-tick" data-live-search="true"
                    title="Chọn Sensor">
                #{list items:sensorList, as:'item'}
                <option value="${item.id}">${item.name}</option>
                #{/list}
            </select>

        </div>
        <p class="alert-danger" style="margin-top: 10px">${notification}</p>
        <div class="form-inline action-button">
            <button type="submit" class="btn btn-info admin-btn" style="margin-right: 30px;">Tìm Kiếm</button>
        </div>
    </div>

</div>
#{/form}
#{if notification == null}
<div style="width:100%;margin-top: 50px;">
    <canvas id="chart"></canvas>
</div>
#{/if}


<script>
    $(document).ready(function () {
        $('#dp1, #dp2').datepicker({
            format: "dd-mm-yyyy",
            autoclose: true,
        }).on('change', function () {
            $('.datepicker').hide();
        });
    });

    var medium=[];
    var max=[];
    var min=[];
    var LABEL =[];

    #{list items:dataMedium, as:'item'}
        medium.push(${item});
    #{/list}

    #{list items:dataMax, as:'item'}
        max.push(${item});
    #{/list}

    #{list items:dataMin, as:'item'}
        min.push(${item});
    #{/list}
    #{list items:labels, as:'item'}
        LABEL.push('${item}');
    #{/list}

    var config = {
            type: 'line',
            data: {
                labels: LABEL,
                datasets: [{
                    label: 'Trung bình',
                    data: medium,
                    borderColor: 'yellow',
                    pointBorderColor: 'yellow',
                    pointBackgroundColor: 'white',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                }, {
                    borderColor: 'red',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    pointBorderColor: 'red',
                    pointBackgroundColor: 'white',
                    label: 'Cao nhất',
                    data: max,
                }, {
                    label: 'Thấp nhất',
                    borderColor: 'green',
                    pointBorderColor: 'green',
                    pointBackgroundColor: 'white',
                    backgroundColor: 'rgba(0, 0, 0, 0)',
                    data: min,
                }]
            },
            options: {
                responsive: true,
                tooltips: {
                    mode: 'label',
                    callbacks: {

                    }
                },
                hover: {
                    mode: 'dataset'
                },
                scales: {
                    xAxes: [{
                        display: true,
                        scaleLabel: {
                            show: true,
                            labelString: 'Buổi'
                        }
                    }],
                    yAxes: [{
                        display: true,
                        scaleLabel: {
                            show: true,
                            labelString: 'Giá trị'
                        },
                        ticks: {
                            suggestedMin: 0,
                            suggestedMax: 0,
                        }
                    }]
                }
            }
        };

     window.onload = function() {
        var chart = document.getElementById("chart").getContext("2d");
        window.myLine = new Chart(chart, config);

    };

</script>